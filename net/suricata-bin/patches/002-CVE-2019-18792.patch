Patch fixes CVE-2019-18792
From 1c63d3905852f746ccde7e2585600b2199cefb4b Mon Sep 17 00:00:00 2001
From: Victor Julien <victor@inliniac.net>
Date: Thu, 21 Nov 2019 16:10:21 +0100
Subject: [PATCH] stream: reject broken ACK packets

Fix evasion posibility by rejecting packets with a broken ACK field.
These packets have a non-0 ACK field, but do not have a ACK flag set.

Bug #3324.

Reported-by: Nicolas Adba
(cherry picked from commit fa692df37a796c3330c81988d15ef1a219afc006)
Index: suricata-8.0.0/src/stream-tcp.c
===================================================================
--- suricata-8.0.0.orig/src/stream-tcp.c
+++ suricata-8.0.0/src/stream-tcp.c
@@ -5572,6 +5572,7 @@ int StreamTcpPacket (ThreadVars *tv, Pac
     /* broken TCP http://ask.wireshark.org/questions/3183/acknowledgment-number-broken-tcp-the-acknowledge-field-is-nonzero-while-the-ack-flag-is-not-set */
     if (!(tcph->th_flags & TH_ACK) && TCP_GET_RAW_ACK(tcph) != 0) {
         StreamTcpSetEvent(p, STREAM_PKT_BROKEN_ACK);
+        goto error;
     }
 
     if ((tcph->th_flags & TH_URG) && StreamTcpInlineDropUrg()) {
